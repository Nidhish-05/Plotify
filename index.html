<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graph Genius | Interactive Graph Generator</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js for creating graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Math.js for parsing mathematical equations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.4.1/math.min.js"></script>

    <!-- Chart.js Zoom Plugin for zoom/pan functionality -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Custom styles to complement Tailwind */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .hero-gradient {
            background: linear-gradient(90deg, #6366f1, #a855f7);
        }
        /* Custom styles for the mode switcher */
        .mode-switch-label {
            cursor: pointer;
            padding: 8px 16px;
            border: 1px solid #cbd5e1;
            border-radius: 9999px;
            transition: all 0.2s ease-in-out;
            user-select: none; /* Prevents text selection on click */
        }
        .mode-switch-input:checked + .mode-switch-label {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
            border-color: #4f46e5;
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-500"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>
                <h1 class="text-2xl font-bold text-slate-900">Graph Genius</h1>
            </div>
            <nav>
                <a href="#generator" class="text-slate-600 hover:text-indigo-500 font-medium">Generator</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Hero Section -->
        <section class="hero-gradient text-white py-20 md:py-28">
            <div class="container mx-auto px-6 text-center">
                <h2 class="text-4xl md:text-6xl font-bold mb-4 leading-tight">Bring Your Data to Life</h2>
                <p class="text-lg md:text-xl max-w-3xl mx-auto text-indigo-100">
                    Visualize functions or plot data points. Customize, zoom, pan, and download your perfect graph.
                </p>
            </div>
        </section>

        <!-- Graph Generator Section -->
        <section id="generator" class="py-16 md:py-24 bg-slate-50">
            <div class="container mx-auto px-6">
                <div class="bg-white p-8 rounded-2xl shadow-lg max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-12">
                    
                    <!-- Controls Column -->
                    <div class="lg:col-span-1">
                        <h3 class="text-2xl font-bold mb-6 text-slate-900">Graph Controls</h3>
                        
                        <!-- Plot Mode Switcher -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-slate-700 mb-3">Plotting Mode</label>
                            <div class="flex items-center space-x-4">
                                <input type="radio" id="modeEquation" name="plotMode" value="equation" class="hidden mode-switch-input" checked>
                                <label for="modeEquation" class="mode-switch-label">Equation</label>
                                
                                <input type="radio" id="modeCoordinates" name="plotMode" value="coordinates" class="hidden mode-switch-input">
                                <label for="modeCoordinates" class="mode-switch-label">Coordinates</label>
                            </div>
                        </div>

                        <!-- Equation Mode Controls -->
                        <div id="equation-controls">
                            <div class="mb-6">
                                <label for="equation" class="block text-sm font-medium text-slate-700 mb-2">y = f(x) Equation</label>
                                <input type="text" id="equation" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="e.g., x^2 or sin(x)">
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div>
                                    <label for="xMin" class="block text-sm font-medium text-slate-700 mb-2">x-Min</label>
                                    <input type="number" id="xMin" value="-10" class="w-full px-4 py-2 border border-slate-300 rounded-lg">
                                </div>
                                <div>
                                    <label for="xMax" class="block text-sm font-medium text-slate-700 mb-2">x-Max</label>
                                    <input type="number" id="xMax" value="10" class="w-full px-4 py-2 border border-slate-300 rounded-lg">
                                </div>
                            </div>
                        </div>

                        <!-- Coordinates Mode Controls -->
                        <div id="coordinates-controls" class="hidden">
                            <div class="mb-6">
                                <label for="coordinates" class="block text-sm font-medium text-slate-700 mb-2">Coordinates (x, y)</label>
                                <textarea id="coordinates" rows="5" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="Enter one coordinate pair per line.&#10;Example:&#10;1, 5&#10;2, 8&#10;3, 2"></textarea>
                            </div>
                        </div>

                        <!-- Common Controls -->
                        <div class="mb-6">
                            <label for="graphType" class="block text-sm font-medium text-slate-700 mb-2">Graph Type</label>
                            <select id="graphType" class="w-full px-4 py-2 border border-slate-300 rounded-lg bg-white">
                                <option value="curvedLine">Curved Line</option>
                                <option value="straightLine">Straight Line</option>
                                <option value="scatter">Scatter Plot</option>
                                <option value="bar">Bar Chart</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div>
                                <label for="xLabel" class="block text-sm font-medium text-slate-700 mb-2">X-Axis Label</label>
                                <input type="text" id="xLabel" value="x-axis" class="w-full px-4 py-2 border border-slate-300 rounded-lg">
                            </div>
                            <div>
                                <label for="yLabel" class="block text-sm font-medium text-slate-700 mb-2">Y-Axis Label</label>
                                <input type="text" id="yLabel" value="y-axis" class="w-full px-4 py-2 border border-slate-300 rounded-lg">
                            </div>
                        </div>
                        <div class="mb-6">
                            <label for="lineColor" class="block text-sm font-medium text-slate-700 mb-2">Graph Color</label>
                            <input type="color" id="lineColor" value="#6366f1" class="w-full h-10 p-1 border border-slate-300 rounded-lg cursor-pointer">
                        </div>

                        <!-- Action Buttons -->
                        <div class="mt-8 space-y-4">
                            <button id="generateBtn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition-all duration-300 transform hover:scale-105 shadow-md">
                                Generate Graph
                            </button>
                            <button id="downloadBtn" class="w-full bg-slate-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-700 transition-all duration-300 transform hover:scale-105 shadow-md hidden">
                                Download as PNG
                            </button>
                        </div>
                        
                        <div id="error-message" class="mt-4 text-red-600 font-medium text-sm"></div>
                    </div>
                    
                    <!-- Graph Display Column -->
                    <div class="lg:col-span-2 flex flex-col items-center justify-center">
                        <div class="w-full h-full bg-slate-100 p-4 rounded-xl flex items-center justify-center min-h-[300px] lg:min-h-[500px]">
                            <canvas id="graphCanvas"></canvas>
                        </div>
                        <!-- Zoom Controls -->
                        <div id="zoom-controls" class="mt-4 flex items-center space-x-3 hidden">
                            <button id="zoomInBtn" class="px-4 py-2 bg-white border border-slate-300 rounded-lg shadow-sm hover:bg-slate-50 transition">Zoom In</button>
                            <button id="zoomOutBtn" class="px-4 py-2 bg-white border border-slate-300 rounded-lg shadow-sm hover:bg-slate-50 transition">Zoom Out</button>
                            <button id="resetZoomBtn" class="px-4 py-2 bg-white border border-slate-300 rounded-lg shadow-sm hover:bg-slate-50 transition">Reset Zoom</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-800 text-slate-400 py-8">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2024 Graph Genius. Created with passion for mathematics and code.</p>
            <p class="text-sm mt-1">A project by Nidhish Bansal, inspired by the beauty of functions.</p>
        </div>
    </footer>

    <script>
        // This event listener ensures that the script runs only after the entire page
        // has been loaded and parsed. This prevents errors from trying to access
        // elements that don't exist yet.
        document.addEventListener('DOMContentLoaded', () => {

            // --- DOM Element Selection ---
            const modeSwitches = document.querySelectorAll('input[name="plotMode"]');
            const equationControls = document.getElementById('equation-controls');
            const coordinatesControls = document.getElementById('coordinates-controls');
            const equationInput = document.getElementById('equation');
            const coordinatesInput = document.getElementById('coordinates');
            const graphTypeSelect = document.getElementById('graphType');
            const xMinInput = document.getElementById('xMin');
            const xMaxInput = document.getElementById('xMax');
            const xLabelInput = document.getElementById('xLabel');
            const yLabelInput = document.getElementById('yLabel');
            const lineColorInput = document.getElementById('lineColor');
            const generateBtn = document.getElementById('generateBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const zoomControls = document.getElementById('zoom-controls');
            const zoomInBtn = document.getElementById('zoomInBtn');
            const zoomOutBtn = document.getElementById('zoomOutBtn');
            const resetZoomBtn = document.getElementById('resetZoomBtn');
            const canvas = document.getElementById('graphCanvas');
            const errorMessageDiv = document.getElementById('error-message');
            const ctx = canvas.getContext('2d');
            
            let graphChart = null;
            // Register the zoom plugin globally
            // FIX: The global variable for the plugin is ChartZoom, not chartjs_plugin_zoom
            Chart.register(ChartZoom);

            // --- Event Listeners ---
            modeSwitches.forEach(sw => sw.addEventListener('change', (e) => {
                const isEquationMode = e.target.value === 'equation';
                equationControls.classList.toggle('hidden', !isEquationMode);
                coordinatesControls.classList.toggle('hidden', isEquationMode);
            }));

            generateBtn.addEventListener('click', generateGraph);
            downloadBtn.addEventListener('click', downloadGraph);
            zoomInBtn.addEventListener('click', () => graphChart?.zoom(1.1));
            zoomOutBtn.addEventListener('click', () => graphChart?.zoom(0.9));
            resetZoomBtn.addEventListener('click', () => graphChart?.resetZoom());

            /**
             * Core function to generate and render the graph based on the current mode.
             */
            function generateGraph() {
                errorMessageDiv.textContent = '';
                const mode = document.querySelector('input[name="plotMode"]:checked').value;
                
                // This will hold the data as an array of {x, y} points, regardless of the source.
                let plotData = []; 
                let chartLabel = 'My Graph';

                try {
                    // --- Step 1: Parse input and populate plotData ---
                    if (mode === 'equation') {
                        const equationStr = equationInput.value;
                        if (!equationStr) throw new Error("Please enter an equation.");
                        
                        const xMin = parseFloat(xMinInput.value);
                        const xMax = parseFloat(xMaxInput.value);
                        if (isNaN(xMin) || isNaN(xMax) || xMin >= xMax) {
                            throw new Error("Please enter a valid x-axis range.");
                        }

                        const compiled = math.parse(equationStr).compile();
                        const step = (xMax - xMin) / 200; // More points for a smoother curve
                        chartLabel = `y = ${equationStr}`;

                        for (let x = xMin; x <= xMax; x += step) {
                            const y = compiled.evaluate({ x: x });
                            plotData.push({ x: x, y: isFinite(y) ? y : null });
                        }
                    } else { // Coordinates mode
                        const coordText = coordinatesInput.value.trim();
                        if (!coordText) throw new Error("Please enter coordinates.");

                        plotData = coordText.split('\n').map((line, index) => {
                            // Use a flexible regex to split by comma, semicolon, or spaces
                            const parts = line.trim().split(/[,;\s]+/).map(Number);
                            if (parts.length !== 2 || parts.some(isNaN)) {
                                throw new Error(`Invalid format on line ${index + 1}: "${line}"`);
                            }
                            return { x: parts[0], y: parts[1] };
                        });
                    }

                    // --- Step 2: Prepare data for Chart.js ---
                    const type = graphTypeSelect.value;
                    let chartData;
                    let chartLabels = undefined;

                    if (type === 'scatter') {
                        chartData = plotData; // Scatter chart uses {x,y} objects directly
                    } else {
                        // Line and Bar charts need separate labels and data arrays
                        chartData = plotData.map(p => p.y);
                        chartLabels = plotData.map(p => p.x.toFixed(2));
                    }

                    // --- Step 3: Render Chart ---
                    if (graphChart) graphChart.destroy();
                    const chartConfig = buildChartConfig(
                        type, chartData, chartLabels, chartLabel, 
                        lineColorInput.value, xLabelInput.value, yLabelInput.value
                    );
                    graphChart = new Chart(ctx, chartConfig);
                    
                    downloadBtn.classList.remove('hidden');
                    zoomControls.classList.remove('hidden');

                } catch (err) {
                    showError(err.message);
                    console.error(err);
                }
            }

            /**
             * Builds the configuration object for Chart.js.
             */
            function buildChartConfig(type, data, labels, chartLabel, color, xLabel, yLabel) {
                const baseDatasetConfig = {
                    label: chartLabel,
                    data: data,
                    borderColor: color,
                    backgroundColor: color,
                    borderWidth: 2.5,
                };

                const config = {
                    data: { 
                        labels: labels, // Can be undefined for scatter charts
                        datasets: [baseDatasetConfig] 
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { title: { display: true, text: xLabel, font: { size: 14, weight: 'bold' } }, grid: { color: '#e2e8f0' } },
                            y: { title: { display: true, text: yLabel, font: { size: 14, weight: 'bold' } }, grid: { color: '#e2e8f0' } }
                        },
                        plugins: {
                            legend: { position: 'top' },
                            tooltip: { enabled: true, mode: 'index', intersect: false },
                            zoom: {
                                pan: { enabled: true, mode: 'xy' },
                                zoom: { wheel: { enabled: true }, pinch: { enabled: true }, mode: 'xy' }
                            }
                        }
                    }
                };

                // Customize config based on graph type
                switch (type) {
                    case 'curvedLine':
                    case 'straightLine':
                        config.type = 'line';
                        // For line charts, connect points over null values (e.g., for tan(x))
                        config.data.datasets[0].spanGaps = true; 
                        config.options.elements = { point: { radius: 0 }, line: { tension: type === 'curvedLine' ? 0.4 : 0 } };
                        break;
                    case 'scatter':
                        config.type = 'scatter';
                        // Scatter plots require a linear x-axis to plot (x,y) data correctly
                        config.options.scales.x.type = 'linear'; 
                        break;
                    case 'bar':
                        config.type = 'bar';
                        break;
                }
                return config;
            }

            /**
             * Handles downloading the canvas as a PNG.
             */
            function downloadGraph() {
                if (!graphChart) {
                    showError("Please generate a graph first.");
                    return;
                }
                const link = document.createElement('a');
                link.download = 'graph_genius.png';
                const newCanvas = document.createElement('canvas');
                newCanvas.width = canvas.width;
                newCanvas.height = canvas.height;
                const newCtx = newCanvas.getContext('2d');
                newCtx.fillStyle = '#ffffff'; // Set a white background for the PNG
                newCtx.fillRect(0, 0, newCanvas.width, newCanvas.height);
                newCtx.drawImage(canvas, 0, 0);
                link.href = newCanvas.toDataURL('image/png');
                link.click();
            }

            /**
             * Displays an error message.
             */
            function showError(message) {
                errorMessageDiv.textContent = `⚠️ ${message}`;
                downloadBtn.classList.add('hidden');
                zoomControls.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
